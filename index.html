<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerenciador de Planos de Leitura</title>
    
    <!-- Link CSS Principal (Base e Layout) -->
    <link rel="stylesheet" href="css/style.css">
    <!-- Link CSS Neuro-Learning (M√≥dulo Cognitivo e Wizard) - ATUALIZADO v2.0.5 -->
    <link rel="stylesheet" href="css/neuro-style.css">

    <!-- Link para Material Symbols (Google Fonts) -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200">
    <!-- Link para Google Fonts (Roboto, Ubuntu) - Mantidos -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Ubuntu:wght@700&display=swap" rel="stylesheet">
    
    <!-- NOVAS FONTES (NEURO-LEARNING): Inter e Playfair Display -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Playfair+Display:ital,wght@0,600;0,700;1,400&display=swap" rel="stylesheet">

    <!-- Favicon -->
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <!-- Firebase SDK (M√≥dulos ES6) -->
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js" type="module"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js" type="module"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js" type="module"></script>
    <!-- Link para o Manifest do PWA -->
    <link rel="manifest" href="manifest.json">
</head>
<body>
    <header>
        <!-- NOVO CONTAINER PARA INFORMA√á√ïES DE VERS√ÉO E USU√ÅRIO -->
        <div id="header-meta-info" style="display: none;">
            <div id="version-info" class="header-info-tag">
                <span class="material-symbols-outlined">info</span>
                <span id="version-display"></span> <!-- O n√∫mero da vers√£o vir√° aqui -->
            </div>
            <div id="user-email-info" class="header-info-tag">
                <span class="material-symbols-outlined">person</span>
                <span id="user-email-display"></span>
            </div>
        </div>

        <div class="header-top">
            <img src="logo.png" alt="Logo do Gerenciador de Planos de Leitura: livro aberto com calend√°rio, gradiente vermelho-rosa-roxo-azul" class="logo">
            <h1>Gerenciador de Planos de Leitura</h1>
        </div>
        <hr class="header-separator">
        <div class="acoes-dados">
            <button id="install-button" style="display: none;" title="Instalar aplicativo no dispositivo">
    <span class="material-symbols-outlined">download</span> Instalar App
            </button>
            <!-- Bot√µes Principais -->
            <button id="novo-plano" style="display: none;">
                <span class="material-symbols-outlined">description</span> Novo
            </button>
            <button id="inicio" style="display: none;">
                <span class="material-symbols-outlined">home</span> In√≠cio
            </button>
            <button id="exportar-agenda" style="display: none;">
                <span class="material-symbols-outlined">event_note</span> Agenda
            </button>
            <button id="reavaliar-carga-btn" style="display: none;">
                <span class="material-symbols-outlined">balance</span> Reavaliar
            </button>

            <!-- Formul√°rio de Autentica√ß√£o -->
            <div id="auth-form" style="display: none;">
                <input type="email" id="email-login" placeholder="Seu Email" required title="Digite seu email para login ou cadastro">
                <input type="password" id="password-login" placeholder="Sua Senha" required title="Digite sua senha (m√≠nimo 6 caracteres para cadastro)">
                <button id="login-email-button" title="Entrar com seu email e senha">Login</button>
                <button id="signup-email-button" title="Criar uma nova conta com seu email e senha">Cadastrar</button>
                <button id="cancel-auth-button" style="display: none;" title="Fechar formul√°rio de login/cadastro">Cancelar</button>
            </div>

            <!-- Bot√µes de Controle de Autentica√ß√£o -->
            <button id="show-auth-button" style="display: block;">
                <span class="material-symbols-outlined">login</span> Login/Cadastro
            </button>
            <button id="logout-button" style="display: none;">
                <span class="material-symbols-outlined">logout</span> Sair
            </button>
            
            <button id="sync-firebase" style="display: none;">
                <span class="material-symbols-outlined">cloud_sync</span> Sincronizar com Firebase
            </button>
        </div>
    </header>

    <main>
        <!-- Se√ß√£o de Revis√£o Espa√ßada (SRS) - NOVA -->
        <section id="revisoes-section" style="display: none; border-left: 5px solid #8e44ad; background-color: #fcf6fd;">
            <h2 style="color: #8e44ad; border-bottom-color: #e1bee7;">
                <span class="material-symbols-outlined">all_inclusive</span> 
                Revis√µes Ativas (SRS)
            </h2>
            <p style="font-size: 0.9em; color: #666; margin-bottom: 15px;">
                Complete estas micro-sess√µes para garantir a reten√ß√£o de longo prazo.
            </p>
            <div id="lista-revisoes" class="neuro-list-container" style="max-height: none; background: transparent; border: none; padding: 0;">
                <!-- Cards de revis√£o injetados via JS -->
            </div>
        </section>

        <!-- Se√ß√µes de Painel (conte√∫do gerado por ui.js) -->
        <section id="leituras-atrasadas-section" style="display: none;">
            <h2><span class="material-symbols-outlined">warning</span> Leituras Atrasadas</h2>
            <div id="lista-leituras-atrasadas"></div>
            <p id="sem-leituras-atrasadas" style="display: none;">Parab√©ns! Nenhuma leitura atrasada encontrada.</p>
        </section>

        <section id="proximas-leituras-section" style="display: none;">
            <h2><span class="material-symbols-outlined">event_upcoming</span> Pr√≥ximas Leituras Agendadas</h2>
            <div id="lista-proximas-leituras"></div>
            <p id="sem-proximas-leituras" style="display: none;">Nenhuma leitura agendada para os pr√≥ximos dias.</p>
        </section>

        <!-- Se√ß√£o para Planos Pausados -->
        <section id="planos-pausados-section" style="display: none;">
            <h2><span class="material-symbols-outlined">pause_circle</span> Planos Pausados</h2>
            <div id="lista-planos-pausados"></div>
            <p id="sem-planos-pausados" style="display: none;">Voc√™ n√£o possui planos pausados no momento.</p>
        </section>
        
        <!-- Se√ß√£o de Cadastro/Edi√ß√£o de Plano -->
        <section id="cadastro-plano" style="display: none;">
            <button id="inicio-cadastro" style="display: block;">
                <span class="material-symbols-outlined">arrow_back</span> Voltar para In√≠cio
            </button>
            <h2>Novo Plano de Leitura</h2>
            <form id="form-plano">
                <div class="form-group">
                    <label for="titulo-livro">T√≠tulo do Livro:</label>
                    <input type="text" id="titulo-livro" name="titulo-livro" required title="Digite o nome do livro que voc√™ deseja ler">
                </div>
                <div class="form-group">
                    <label for="link-drive">Link Anota√ß√µes (Drive, Notion, URL, Opcional):</label>
                    <input type="url" id="link-drive" name="link-drive" title="Cole o link do seu documento de anota√ß√µes (Google Drive, Notion, etc.). Ex: https://..." placeholder="https://...">
                </div>
                <div class="form-group">
                    <label for="pagina-inicio">P√°gina de In√≠cio da Leitura:</label>
                    <input type="number" id="pagina-inicio" name="pagina-inicio" min="1" required title="P√°gina onde voc√™ come√ßar√° a leitura do livro/se√ß√£o">
                </div>
                <div class="form-group">
                    <label for="pagina-fim">P√°gina Final da Leitura:</label>
                    <input type="number" id="pagina-fim" name="pagina-fim" min="1" required title="√öltima p√°gina que voc√™ planeja ler neste plano">
                </div>
                
                <!-- IN√çCIO DA SE√á√ÉO MODIFICADA -->
                <div class="form-group">
                    <label>Definir Per√≠odo Por:</label>
                    <div class="periodo-opcoes">
                        <input type="radio" id="definir-por-datas" name="definicao-periodo" value="datas" checked title="Definir o in√≠cio e o fim exatos do plano">
                        <label for="definir-por-datas">Datas de In√≠cio e Fim</label>
                        
                        <input type="radio" id="definir-por-dias" name="definicao-periodo" value="dias" title="Definir o in√≠cio e quantos dias de leitura voc√™ quer ter">
                        <label for="definir-por-dias">N¬∫ de Dias de Leitura</label>
                        
                        <input type="radio" id="definir-por-paginas" name="definicao-periodo" value="paginas" title="Definir o in√≠cio e a meta di√°ria de p√°ginas">
                        <label for="definir-por-paginas">P√°ginas por Dia</label>
                    </div>
                </div>

                <!-- Bloco para a op√ß√£o "Datas de In√≠cio e Fim" -->
                <div id="periodo-por-datas" style="display: block;">
                    <div class="form-group">
                        <label for="data-inicio">Data de In√≠cio:</label>
                        <input type="date" id="data-inicio" name="data-inicio" required title="Escolha a data em que voc√™ come√ßar√° a leitura">
                    </div>
                    <div class="form-group">
                        <label for="data-fim">Data de Fim:</label>
                        <input type="date" id="data-fim" name="data-fim" required title="Escolha a data em que voc√™ planeja terminar a leitura">
                    </div>
                </div>

                <!-- Bloco para a op√ß√£o "N¬∫ de Dias de Leitura" -->
                <div id="periodo-por-dias" style="display: none;">
                    <div class="form-group">
                        <label for="data-inicio-dias">Data de In√≠cio:</label>
                        <input type="date" id="data-inicio-dias" name="data-inicio-dias" title="Escolha a data em que voc√™ come√ßar√° a leitura">
                    </div>
                    <div class="form-group">
                        <label for="numero-dias">N√∫mero de Dias de Leitura:</label>
                        <input type="number" id="numero-dias" name="numero-dias" min="1" title="Quantos dias EFETIVOS de leitura voc√™ planeja ter (ex: 30 dias lendo de seg-sex)">
                    </div>
                </div>

                <!-- Bloco para a nova op√ß√£o "P√°ginas por Dia" -->
                <div id="periodo-por-paginas" style="display: none;">
                    <div class="form-group">
                        <label for="data-inicio-paginas">Data de In√≠cio:</label>
                        <input type="date" id="data-inicio-paginas" name="data-inicio-paginas" title="Escolha a data em que voc√™ come√ßar√° a leitura">
                    </div>
                    <div class="form-group">
                        <label for="paginas-por-dia">P√°ginas a Ler por Dia (Meta):</label>
                        <input type="number" id="paginas-por-dia" name="paginas-por-dia" min="1" title="Quantas p√°ginas voc√™ pretende ler em cada dia de leitura">
                    </div>
                </div>

                <!-- Elemento para feedback da estimativa -->
                <p id="estimativa-data-fim" class="form-feedback"></p>

                <!-- FIM DA SE√á√ÉO MODIFICADA -->
                
                <div class="form-group">
                    <label for="periodicidade">Ler Em Quais Dias:</label>
                    <select id="periodicidade" name="periodicidade" required title="Selecione a frequ√™ncia de leitura">
                        <option value="diario">Todos os Dias</option>
                        <option value="semanal">Apenas Dias da Semana Selecionados</option>
                    </select>
                </div>
                <div id="dias-semana-selecao" class="form-group" style="display: none;">
                    <label>Selecione os Dias da Semana para Leitura:</label>
                    <div class="dias-semana-lista">
                        <div><input type="checkbox" id="domingo" name="dia-semana" value="0" title="Incluir Domingo nos dias de leitura"><label for="domingo">Domingo</label></div>
                        <div><input type="checkbox" id="segunda" name="dia-semana" value="1" title="Incluir Segunda-feira nos dias de leitura"><label for="segunda">Segunda</label></div>
                        <div><input type="checkbox" id="terca" name="dia-semana" value="2" title="Incluir Ter√ßa-feira nos dias de leitura"><label for="terca">Ter√ßa</label></div>
                        <div><input type="checkbox" id="quarta" name="dia-semana" value="3" title="Incluir Quarta-feira nos dias de leitura"><label for="quarta">Quarta</label></div>
                        <div><input type="checkbox" id="quinta" name="dia-semana" value="4" title="Incluir Quinta-feira nos dias de leitura"><label for="quinta">Quinta</label></div>
                        <div><input type="checkbox" id="sexta" name="dia-semana" value="5" title="Incluir Sexta-feira nos dias de leitura"><label for="sexta">Sexta</label></div>
                        <div><input type="checkbox" id="sabado" name="dia-semana" value="6" title="Incluir S√°bado nos dias de leitura"><label for="sabado">S√°bado</label></div>
                    </div>
                </div>
                <button type="submit">Salvar Plano</button>
            </form>
        </section>

        <!-- Se√ß√£o da Lista de Planos Ativos -->
        <section id="planos-leitura">
            <h2>Meus Planos de Leitura</h2>
            <div id="paginador-planos" class="hidden"></div>
            <div id="lista-planos">
                <p>Carregando seus planos...</p>
            </div>
        </section>

        <!-- Modal de Rec√°lculo -->
        <div id="recalculo-modal" class="reavaliacao-modal-overlay">
            <div class="reavaliacao-modal-content">
                <div class="reavaliacao-modal-header">
                    <h2><span class="material-symbols-outlined">restart_alt</span> Remanejar e Recalcular Plano</h2>
                    <button id="recalculo-modal-close-btn" class="reavaliacao-modal-close">√ó</button>
                </div>
                <p class="reavaliacao-descricao">
                    O plano <strong id="recalculo-plano-titulo"></strong> ser√° recalculado. Ajuste os dias da semana e escolha como redistribuir as p√°ginas n√£o lidas.
                </p>
                <div class="form-group">
                    <label>Remanejar Dias de Leitura:</label>
                    <div id="recalculo-dias-semana-selecao" class="dias-semana-lista">
                        <div><input type="checkbox" id="recalculo-domingo" name="recalculo-dia-semana" value="0"><label for="recalculo-domingo">Dom</label></div>
                        <div><input type="checkbox" id="recalculo-segunda" name="recalculo-dia-semana" value="1"><label for="recalculo-segunda">Seg</label></div>
                        <div><input type="checkbox" id="recalculo-terca" name="recalculo-dia-semana" value="2"><label for="recalculo-terca">Ter</label></div>
                        <div><input type="checkbox" id="recalculo-quarta" name="recalculo-dia-semana" value="3"><label for="recalculo-quarta">Qua</label></div>
                        <div><input type="checkbox" id="recalculo-quinta" name="recalculo-dia-semana" value="4"><label for="recalculo-quinta">Qui</label></div>
                        <div><input type="checkbox" id="recalculo-sexta" name="recalculo-dia-semana" value="5"><label for="recalculo-sexta">Sex</label></div>
                        <div><input type="checkbox" id="recalculo-sabado" name="recalculo-dia-semana" value="6"><label for="recalculo-sabado">S√°b</label></div>
                    </div>
                </div>
                <div class="form-group">
                    <label>M√©todo de Rec√°lculo:</label>
                    <div>
                        <input type="radio" id="recalculo-por-data" name="metodo-recalculo" value="data" checked>
                        <label for="recalculo-por-data">Definir Nova Data Final</label>
                        <input type="radio" id="recalculo-por-paginas" name="metodo-recalculo" value="paginas">
                        <label for="recalculo-por-paginas">Definir P√°ginas por Dia</label>
                    </div>
                </div>
                <div id="recalculo-opcao-data" class="form-group">
                    <label for="nova-data-fim-input">Nova Data de Fim:</label>
                    <input type="date" id="nova-data-fim-input" name="nova-data-fim-input" required>
                </div>
                <div id="recalculo-opcao-paginas" class="form-group" style="display: none;">
                    <label for="nova-paginas-por-dia-input">P√°ginas a Ler por Dia (Aprox.):</label>
                    <input type="number" id="nova-paginas-por-dia-input" name="nova-paginas-por-dia-input" min="1" required>
                </div>
                <div class="recalculo-modal-actions">
                    <button id="cancel-recalculo-btn" class="button-cancel">Cancelar</button>
                    <button id="confirm-recalculo-btn" class="button-confirm">Confirmar Remanejamento</button>
                </div>
            </div>
        </div>

        <!-- MODAL DE REAVALIA√á√ÉO -->
        <div id="reavaliacao-modal" class="reavaliacao-modal-overlay">
            <div class="reavaliacao-modal-content">
                <div class="reavaliacao-modal-header">
                    <h2><span class="material-symbols-outlined">calendar_view_week</span> Carga de Leitura Semanal</h2>
                    <button id="fechar-reavaliacao-btn" class="reavaliacao-modal-close">√ó</button>
                </div>
                <p class="reavaliacao-descricao">
                    Visualize a m√©dia de p√°ginas a serem lidas por dia. Clique em um plano para remanejar sua carga de leitura.
                </p>
                <div class="reavaliacao-tabela-container">
                    <table id="tabela-reavaliacao">
                        <thead>
                            <tr>
                                <th>Dia da Semana</th>
                                <th>Planos Ativos (M√©dia de P√°ginas/Dia)</th>
                                <th>Total de P√°ginas do Dia</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- O conte√∫do ser√° gerado dinamicamente via JavaScript -->
                        </tbody>
                    </table>
                </div>
                <div id="reavaliacao-legenda" class="reavaliacao-legenda-container">
                    <!-- A legenda ser√° gerada dinamicamente via JavaScript -->
                </div>
            </div>
        </div>
        
        <!-- Modal de Exporta√ß√£o para Agenda -->
        <div id="agenda-modal" class="reavaliacao-modal-overlay">
            <div class="reavaliacao-modal-content">
                <div class="reavaliacao-modal-header">
                    <h2><span class="material-symbols-outlined">event_note</span> Exportar para Agenda</h2>
                    <button id="cancel-agenda-export" class="reavaliacao-modal-close">√ó</button>
                </div>
                <p class="reavaliacao-descricao">
                    Defina o hor√°rio padr√£o para seus blocos de leitura. Todos os dias de leitura dos seus planos ativos ser√£o adicionados √† sua agenda neste intervalo de tempo.
                </p>
                <div class="form-group">
                    <label for="agenda-start-time">Hor√°rio de In√≠cio da Leitura:</label>
                    <input type="time" id="agenda-start-time" name="agenda-start-time" value="16:30" required>
                </div>
                <div class="form-group">
                    <label for="agenda-end-time">Hor√°rio de Fim da Leitura:</label>
                    <input type="time" id="agenda-end-time" name="agenda-end-time" value="17:00" required>
                </div>
                <div class="recalculo-modal-actions">
                    <button id="cancel-agenda-export-btn" class="button-cancel">Cancelar</button>
                    <button id="confirm-agenda-export" class="button-confirm">Gerar Arquivo (.ics)</button>
                </div>
            </div>
        </div>
        
        <!-- Modal de Changelog -->
        <div id="changelog-modal" class="reavaliacao-modal-overlay">
            <div class="reavaliacao-modal-content">
                <div class="reavaliacao-modal-header">
                    <h2 id="changelog-modal-title"><span class="material-symbols-outlined">rocket_launch</span></h2>
                    <button id="changelog-modal-close-btn" class="reavaliacao-modal-close">√ó</button>
                </div>
                <div id="changelog-modal-content" class="changelog-content">
                    <!-- Conte√∫do ser√° injetado dinamicamente via JavaScript -->
                </div>
            </div>
        </div>

        <!-- NOVO MODAL: NEURO-INSIGHTS & M.E.T.A. -->
        <div id="neuro-modal" class="reavaliacao-modal-overlay">
            <div class="reavaliacao-modal-content neuro-theme">
                <div class="reavaliacao-modal-header">
                    <h2 id="neuro-modal-title"><span class="material-symbols-outlined">psychology</span> Neuro-Insights</h2>
                    <button id="close-neuro-modal" class="reavaliacao-modal-close">√ó</button>
                </div>
                
                <!-- Conte√∫do Din√¢mico Injetado via JS -->
                <div id="neuro-modal-body" class="neuro-body-content">
                    <!-- Abas ou se√ß√µes para M.E.T.A e Gatilhos ser√£o renderizados aqui -->
                    <p style="color: #666; text-align: center;">Carregando painel cognitivo...</p>
                </div>

                <div class="recalculo-modal-actions">
                     <button id="btn-save-neuro" class="button-confirm">Salvar Neuro-Conex√£o</button>
                </div>
            </div>
        </div>

        <!-- NOVO MODAL: CHECKLIST DE RETEN√á√ÉO (CAPE) -->
        <div id="checklist-modal" class="reavaliacao-modal-overlay">
            <div class="reavaliacao-modal-content neuro-theme">
                <!-- Header Personalizado -->
                <div class="reavaliacao-modal-header" style="background: linear-gradient(135deg, var(--neuro-primary) 0%, #2c3e50 100%); color: white;">
                    <h2 style="color: white; font-family: var(--neuro-font-serif); margin: 0; display: flex; align-items: center; gap: 10px;">
                        <span class="material-symbols-outlined">fact_check</span> Checklist de Reten√ß√£o
                    </h2>
                    <button id="close-checklist-modal" class="reavaliacao-modal-close" style="color: white; opacity: 0.8;">√ó</button>
                </div>

                <!-- Corpo do Modal com Conte√∫do CAPE -->
                <div style="padding: 20px 25px;">
                    
                    <div class="cape-header">
                        <h3>üß† M√©todo C.A.P.E.</h3>
                        <p>Confronto ‚Ä¢ Ancoragem ‚Ä¢ Percep√ß√£o ‚Ä¢ Esquema</p>
                    </div>

                    <!-- Alerta -->
                    <div class="cape-alert-box">
                        ‚ö†Ô∏è N√£o leia passivamente. Escaneie o texto procurando preencher estas 4 categorias.
                    </div>

                    <!-- Grid de Cards -->
                    <div class="cape-cards-grid">
                        <div class="cape-card">
                            <strong>Confronto</strong>
                            <p>O que confrontou o que voc√™ achava que sabia?</p>
                        </div>
                        <div class="cape-card">
                            <strong>Ancoragem</strong>
                            <p>Conecte o novo a algo velho e forte na sua mem√≥ria.</p>
                        </div>
                        <div class="cape-card">
                            <strong>Percep√ß√£o</strong>
                            <p>Qual sentimento ou emo√ß√£o essa verdade gerou?</p>
                        </div>
                        <div class="cape-card">
                            <strong>Esquema</strong>
                            <p>Transforme o texto em um desenho mental ou diagrama.</p>
                        </div>
                    </div>

                    <h3 class="neuro-section-title" style="margin-top: 25px;">‚úÖ Valida√ß√£o Cognitiva</h3>

                    <!-- Tabela Checklist -->
                    <div class="reavaliacao-tabela-container">
                        <table class="cape-table">
                            <thead>
                                <tr>
                                    <th style="text-align: center; width: 50px;">Ok?</th>
                                    <th>Pergunta de Controle</th>
                                    <th>Objetivo Cognitivo / Espiritual</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td class="check-cell"><input type="checkbox"></td>
                                    <td>Consigo explicar sem olhar?</td>
                                    <td class="meta-cell"><strong>Metacogni√ß√£o</strong> ‚Ä¢ Evitar Ilus√£o de Compet√™ncia</td>
                                </tr>
                                <tr>
                                    <td class="check-cell"><input type="checkbox"></td>
                                    <td>Desenhei a ideia?</td>
                                    <td class="meta-cell"><strong>Codifica√ß√£o Dupla</strong> ‚Ä¢ Clareza da Vis√£o</td>
                                </tr>
                                <tr>
                                    <td class="check-cell"><input type="checkbox"></td>
                                    <td>Mudou alguma atitude hoje?</td>
                                    <td class="meta-cell"><strong>Plasticidade Neural</strong> ‚Ä¢ Santifica√ß√£o / Obedi√™ncia</td>
                                </tr>
                                <tr>
                                    <td class="check-cell"><input type="checkbox"></td>
                                    <td>Conectei com a B√≠blia?</td>
                                    <td class="meta-cell"><strong>Associa√ß√£o</strong> ‚Ä¢ Analogia da F√©</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Footer com A√ß√£o -->
                <div class="recalculo-modal-actions" style="padding: 15px 20px; border-top: 1px solid #eee; background: #fafafa; border-radius: 0 0 8px 8px; margin-top: 0;">
                    <button id="btn-close-checklist-action" class="button-confirm" style="width: 100%;">
                        Conclu√≠do
                    </button>
                </div>
            </div>
        </div>

        <!-- NOVO MODAL: DI√ÅRIO DE BORDO (HIST√ìRICO DE SESS√ïES) -->
        <div id="logbook-modal" class="reavaliacao-modal-overlay">
            <div class="reavaliacao-modal-content neuro-theme" style="max-width: 600px; display: flex; flex-direction: column; max-height: 85vh;">
                <!-- Header -->
                <div class="reavaliacao-modal-header" style="background: linear-gradient(135deg, #2c3e50 0%, #4ca1af 100%); color: white; flex-shrink: 0;">
                    <h2 style="color: white; font-family: var(--neuro-font-serif); margin: 0; display: flex; align-items: center; gap: 10px;">
                        <span class="material-symbols-outlined">history_edu</span> Di√°rio de Bordo
                    </h2>
                    <button id="close-logbook-modal" class="reavaliacao-modal-close" style="color: white; opacity: 0.8;">√ó</button>
                </div>
                
                <!-- Body (Scrollable) -->
                <div id="logbook-content" style="padding: 20px; overflow-y: auto; flex-grow: 1; background-color: #fdfdfd;">
                    <!-- O conte√∫do (Cap√≠tulo + Lista de Sess√µes) ser√° injetado aqui via JS -->
                </div>

                <!-- Footer (Fixed) com A√ß√£o de Consolida√ß√£o -->
                <div class="recalculo-modal-actions" style="background: #f8f9fa; border-top: 1px solid #e0e0e0; margin-top: 0; border-radius: 0 0 8px 8px; justify-content: space-between; padding: 15px; flex-shrink: 0; flex-wrap: wrap; gap: 10px;">
                    
                    <!-- Bot√£o de Consolidar Cap√≠tulo (Novo) -->
                    <button id="btn-consolidate-chapter" class="btn-neuro-action" style="display: none; background-color: #2c3e50; color: white; border: 1px solid #2c3e50; margin-right: auto; padding: 8px 15px;">
                        <span class="material-symbols-outlined">inventory_2</span> Consolidar
                    </button>

                    <span style="font-size: 0.8em; color: #7f8c8d; align-self: center; font-style: italic; flex-grow: 1; text-align: right; margin-right: 10px;">
                        <span class="material-symbols-outlined" style="font-size: 1em; vertical-align: middle;">info</span>
                        Contexto
                    </span>
                    <button id="btn-new-session-logbook" class="button-confirm" style="background-color: var(--neuro-accent); display: flex; align-items: center; gap: 5px;">
                        <span class="material-symbols-outlined" style="font-size: 1.1em;">add_circle</span> Nova Sess√£o
                    </button>
                </div>
            </div>
        </div>

        <!-- NOVO MODAL: TIMELINE (FIO DA MEADA) - v2.0.5 -->
        <div id="timeline-modal" class="reavaliacao-modal-overlay">
            <div class="reavaliacao-modal-content neuro-theme" style="max-width: 600px;">
                <div class="reavaliacao-modal-header" style="background: linear-gradient(135deg, #2c3e50, #8e44ad); color: white;">
                    <h2 style="color: white; margin: 0;"><span class="material-symbols-outlined">timeline</span> Fio da Meada</h2>
                    <button id="close-timeline" class="reavaliacao-modal-close" style="color: white;">√ó</button>
                </div>
                <div id="timeline-content" class="timeline-v-flow" style="padding: 20px;">
                    <!-- Conte√∫do injetado via JS -->
                </div>
            </div>
        </div>

    </main>

    <footer>
        <p>¬© 2024-2025 Gerenciador de Planos de Leitura</p>
    </footer>

    <script src="main.js" type="module"></script>

</body>
</html>
